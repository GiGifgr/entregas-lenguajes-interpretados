<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PONG (1972) — Versión Web</title>
  <style>
    :root{
      --fg:#fff;
      --bg:#000;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif}
    .wrap{min-height:100%;display:grid;place-items:center;padding:20px}
    canvas{width:min(96vw, 1000px);height:auto;display:block;aspect-ratio:4/3;background:var(--bg);border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.6), 0 0 0 1px rgba(255,255,255,.08) inset}
    .hud{position:fixed;inset:auto 0 12px 0;display:flex;justify-content:center;gap:20px;font-size:14px;opacity:.9;pointer-events:none}
    kbd{background:#111;border:1px solid #333;border-bottom-color:#111;border-radius:6px;padding:.15em .45em;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;box-shadow:0 1px 0 #000, 0 0 0 1px #0006 inset}
    .note{position:fixed;top:12px;left:50%;transform:translateX(-50%);font-size:13px;opacity:.75}
  </style>
</head>
<body>
  <div class="wrap">
    <canvas id="game" width="800" height="600" aria-label="PONG"></canvas>
  </div>
  <div class="hud" aria-hidden="true">
    <div><strong>Jugador 1</strong> <kbd>W</kbd>/<kbd>S</kbd></div>
    <div><strong>Jugador 2</strong> <kbd>↑</kbd>/<kbd>↓</kbd></div>
    <div><kbd>Espacio</kbd> iniciar/pausa • <kbd>R</kbd> reiniciar</div>
  </div>
  <div class="note">Fiel al original: fondo negro, paletas y bola blancas, línea central y marcador clásico.</div>

  <script>
  (function(){
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    // Diseño lógico (independiente de DPI). Aspecto 4:3 — 800x600.
    const W = 800, H = 600;
    canvas.width = W; canvas.height = H;

    // Escalado HiDPI para nitidez.
    function setupHiDPI(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      canvas.width = W * dpr;
      canvas.height = H * dpr;
      canvas.style.width = 'min(96vw, 1000px)'; // controlado por CSS (aspect-ratio)
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    setupHiDPI();
    window.addEventListener('resize', setupHiDPI);

    // Entidades del juego
    const PADDLE_W = 12, PADDLE_H = 100, PADDLE_SPEED = 380;
    const BALL_SIZE = 10, BALL_SPEED_START = 300, BALL_SPEED_MAX = 720;
    const CENTER_LINE_W = 6; // línea central estilo clásico
    const SCORE_TO_WIN = 11; // como en muchas variantes clásicas

    let left = { x: 30, y: H/2 - PADDLE_H/2, w: PADDLE_W, h: PADDLE_H, up:false, down:false };
    let right = { x: W-30-PADDLE_W, y: H/2 - PADDLE_H/2, w: PADDLE_W, h: PADDLE_H, up:false, down:false };

    let ball = { x: W/2, y: H/2, vx: 0, vy: 0, s: BALL_SIZE, speed: BALL_SPEED_START };
    let score = { left: 0, right: 0 };

    let running = false, showIntro = true, gameOver = false, lastTime = 0, serveTimer = 0;

    function rndSign(){ return Math.random() < 0.5 ? -1 : 1; }

    function serve(direction = rndSign()){
      ball.x = W/2; ball.y = H/2;
      // Ángulo inicial entre -25° y 25° en radianes, evitando horizontales perfectas
      const angle = (Math.random()*50 - 25) * Math.PI/180;
      ball.speed = BALL_SPEED_START;
      ball.vx = Math.cos(angle) * ball.speed * direction;
      ball.vy = Math.sin(angle) * ball.speed;
      serveTimer = 0.7; // pequeño delay antes de moverse
    }

    function reset(){
      left.y = H/2 - PADDLE_H/2; right.y = H/2 - PADDLE_H/2;
      score.left = 0; score.right = 0;
      gameOver = false; showIntro = false; running = true;
      serve(rndSign());
    }

    function clamp(v,min,max){ return v<min?min:v>max?max:v; }

    // Input
    const key = {};
    window.addEventListener('keydown', (e)=>{
      key[e.code] = true;
      if(e.code === 'Space') { running = !running; showIntro = false; }
      if(e.code === 'KeyR') { reset(); }
      if(['ArrowUp','ArrowDown','KeyW','KeyS','Space'].includes(e.code)) e.preventDefault();
    }, {passive:false});
    window.addEventListener('keyup', (e)=>{ key[e.code] = false; });

    // Bucle principal
    function loop(t){
      const dt = Math.min(1/30, (t - lastTime)/1000 || 0); // limitar saltos grandes
      lastTime = t;

      if(running && !gameOver){ update(dt); }
      draw();
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);

    function update(dt){
      // Actualizar input a paletas
      left.up = !!key['KeyW']; left.down = !!key['KeyS'];
      right.up = !!key['ArrowUp']; right.down = !!key['ArrowDown'];

      // Movimiento paletas
      if(left.up) left.y -= PADDLE_SPEED*dt;
      if(left.down) left.y += PADDLE_SPEED*dt;
      if(right.up) right.y -= PADDLE_SPEED*dt;
      if(right.down) right.y += PADDLE_SPEED*dt;
      left.y = clamp(left.y, 0, H-left.h);
      right.y = clamp(right.y, 0, H-right.h);

      // Saque con retardo
      if(serveTimer>0){ serveTimer -= dt; return; }

      // Movimiento bola
      ball.x += ball.vx*dt; ball.y += ball.vy*dt;

      // Rebote en bordes superior/inferior
      if(ball.y - ball.s <= 0 && ball.vy < 0){ ball.y = ball.s; ball.vy *= -1; }
      if(ball.y + ball.s >= H && ball.vy > 0){ ball.y = H - ball.s; ball.vy *= -1; }

      // Colisiones con paletas
      // Izquierda
      if(ball.vx < 0 && ball.x - ball.s <= left.x + left.w && ball.x - ball.s >= left.x && ball.y >= left.y && ball.y <= left.y + left.h){
        collideWithPaddle(left);
      }
      // Derecha
      if(ball.vx > 0 && ball.x + ball.s >= right.x && ball.x + ball.s <= right.x + right.w && ball.y >= right.y && ball.y <= right.y + right.h){
        collideWithPaddle(right);
      }

      // Puntos
      if(ball.x < -30){ // punto para derecha
        score.right++;
        checkGameOver();
        serve(+1);
      } else if(ball.x > W+30){ // punto para izquierda
        score.left++;
        checkGameOver();
        serve(-1);
      }
    }

    function collideWithPaddle(p){
      // Normalizar punto de impacto (-1 arriba, 0 centro, +1 abajo)
      const hitPos = ((ball.y - (p.y + p.h/2)))/(p.h/2);
      const maxBounce = 50 * Math.PI/180; // 50° de desvío máximo
      const angle = hitPos * maxBounce;
      const dir = (p === left) ? 1 : -1;

      // Incremento de velocidad con límite
      ball.speed = Math.min(BALL_SPEED_MAX, ball.speed * 1.06);
      ball.vx = Math.cos(angle) * ball.speed * dir;
      ball.vy = Math.sin(angle) * ball.speed;

      // Recolocar fuera de la paleta para evitar quedarse pegado
      if(p === left){ ball.x = left.x + left.w + ball.s; }
      else { ball.x = right.x - ball.s; }
    }

    function checkGameOver(){
      if(score.left >= SCORE_TO_WIN || score.right >= SCORE_TO_WIN){
        gameOver = true; running = false;
      }
    }

    // Dibujo
    function draw(){
      // Fondo
      ctx.fillStyle = '#000';
      ctx.fillRect(0,0,W,H);

      // Línea central punteada (clásica)
      ctx.save();
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = CENTER_LINE_W;
      ctx.setLineDash([16, 20]);
      ctx.beginPath();
      ctx.moveTo(W/2, 0);
      ctx.lineTo(W/2, H);
      ctx.stroke();
      ctx.restore();

      // Paletas
      ctx.fillStyle = '#fff';
      ctx.fillRect(left.x, left.y, left.w, left.h);
      ctx.fillRect(right.x, right.y, right.w, right.h);

      // Bola (cuadrada como la original)
      ctx.fillRect(Math.round(ball.x - ball.s), Math.round(ball.y - ball.s), ball.s*2, ball.s*2);

      // Marcador
      ctx.fillStyle = '#fff';
      ctx.font = 'bold 80px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      ctx.fillText(String(score.left), W*0.25, 24);
      ctx.fillText(String(score.right), W*0.75, 24);

      // Overlays
      if(showIntro){
        overlay('P O N G', 'Pulsa ESPACIO para iniciar');
      } else if(!running && !gameOver){
        overlay('P A U S A', 'Pulsa ESPACIO para continuar');
      }
      if(gameOver){
        const winner = score.left > score.right ? 'Gana Jugador 1' : 'Gana Jugador 2';
        overlay(winner, 'Pulsa R para reiniciar');
      }
    }

    function overlay(title, subtitle){
      ctx.save();
      ctx.globalAlpha = .85;
      ctx.fillStyle = '#000';
      ctx.fillRect(0,0,W,H);
      ctx.globalAlpha = 1;
      ctx.fillStyle = '#fff';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.font = '900 72px system-ui, sans-serif';
      ctx.fillText(title, W/2, H/2 - 30);
      ctx.font = '600 20px system-ui, sans-serif';
      ctx.fillText(subtitle, W/2, H/2 + 28);
      ctx.restore();
    }

    // Iniciar en estado de espera
    serve(rndSign());
  })();
  </script>
</body>
</html>



